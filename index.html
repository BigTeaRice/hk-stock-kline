<!DOCTYPE html>
<html>
<head>
    <title>港股实时 K 线</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.0/dist/echarts.min.js"></script>
    <style>
        #chart { width: 100%; height: 80vh; margin: 20px auto; }
    </style>
</head>
<body>
    <h1 style="text-align: center;">腾讯控股（00700.HK）实时 K 线</h1>
    <div id="chart"></div>

    <script>
        // 初始化图表
        const chartDom = document.getElementById('chart');
        const myChart = echarts.init(chartDom);
        let currentData = []; // 存储实时数据

        // 配置项
        const option = {
            title: { text: '日 K 线图' },
            xAxis: {
                type: 'category',
                data: [],
                scale: true,
                boundaryGap: false,
                axisLine: { onZero: false }
            },
            yAxis: {
                scale: true,
                splitArea: { show: true }
            },
            series: [
                {
                    name: 'K线',
                    type: 'candlestick',
                    data: [],
                    itemStyle: {
                        color: '#ec4561',  // 跌的颜色
                        color0: '#00c853', // 涨的颜色
                        borderColor: '#ec4561',
                        borderColor0: '#00c853'
                    }
                }
            ]
        };

        myChart.setOption(option);

        // 获取实时数据（调用后端接口）
        async function fetchRealTimeData() {
            try {
                const response = await fetch('https://your-backend-url/api/realtime?symbol=00700.HK');
                if (!response.ok) throw new Error('数据获取失败');
                const data = await response.json();
                
                // 更新图表数据（假设后端返回格式：{ timestamps: [], ohlc: [[o,h,l,c], ...] }）
                currentData = data.ohlc.map((item, index) => ({
                    value: item,
                    time: data.timestamps[index]
                }));

                myChart.setOption({
                    xAxis: { data: currentData.map(d => d.time) },
                    series: [{ data: currentData.map(d => d.value) }]
                });
            } catch (error) {
                console.error('更新失败:', error);
            }
        }

        // 初始加载 + 每 60 秒更新
        fetchRealTimeData();
        setInterval(fetchRealTimeData, 60000); // 60秒刷新
    </script>
</body>
</html>